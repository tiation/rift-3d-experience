<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rift Guitar - 3D Experience</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background: white;
            overflow: hidden;
            height: 100vh;
        }

        html, body {
            margin: 0;
            height: 100%;
            overflow: hidden; 
        }

        .main_content_scroll {
            overflow-y: scroll;
            height: 100%;
            pointer-events: all;
        }

        .main_content_scroll::-webkit-scrollbar {
            width: 0px;
            display: none;
        }

        #bear-holder {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 98;
            pointer-events: none;
        }

        .content {
            height: 500vh; /* Make it scrollable */
            position: relative;
            z-index: 1;
        }

        .section {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #010031;
            font-family: Arial, sans-serif;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(2px);
        }

        .section:nth-child(even) {
            background: rgba(240, 240, 240, 0.1);
        }

        .guitar-section {
            background: rgba(255, 255, 255, 0.2);
            flex-direction: column;
            gap: 20px;
        }

        .guitar-section h1 {
            font-size: 3rem;
            margin: 0;
            background: linear-gradient(90deg, #FF6B35 6.25%, #F7931E 94.27%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        .guitar-section p {
            font-size: 1.5rem;
            margin: 0;
            text-align: center;
            max-width: 800px;
        }

        .loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #010031;
            font-family: Arial, sans-serif;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .noise {
            -webkit-animation: noise 1.2s steps(3) infinite both;
            animation: noise 1.2s steps(3) infinite both;
            background: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSJibGFjayIgZmlsbC1vcGFjaXR5PSIwLjEiLz4KPHN2Zz4K");
            background-size: 64px;
            height: 200%;
            left: -50%;
            pointer-events: none;
            position: fixed;
            top: -50%;
            width: 200%;
            will-change: auto;
            z-index: 100;
            opacity: 0.05;
        }

        @keyframes noise {
            0% { -webkit-transform: translate3d(1%,-1%,0); transform: translate3d(1%,-1%,0) }
            10% { -webkit-transform: translate3d(-5%,-2%,0); transform: translate3d(-5%,-2%,0) }
            20% { -webkit-transform: translate3d(10%,5%,0); transform: translate3d(10%,5%,0) }
            30% { -webkit-transform: translate3d(5%,-11%,0); transform: translate3d(5%,-11%,0) }
            40% { -webkit-transform: translate3d(-12%,-5%,0); transform: translate3d(-12%,-5%,0) }
            50% { -webkit-transform: translate3d(10%,9%,0); transform: translate3d(10%,9%,0) }
            60% { -webkit-transform: translate3d(15%,0,0); transform: translate3d(15%,0,0) }
            70% { -webkit-transform: translate3d(-10%,8%,0); transform: translate3d(-10%,8%,0) }
            80% { -webkit-transform: translate3d(10%,2%,0); transform: translate3d(10%,2%,0) }
            90% { -webkit-transform: translate3d(1%,5%,0); transform: translate3d(1%,5%,0) }
            to { -webkit-transform: translate3d(0,8%,0); transform: translate3d(0,8%,0) }
        }
    </style>
</head>
<body>
    <div class="noise"></div>
    
    <div class="loader" id="loader">
        <div>Loading Rift Guitar...</div>
        <div id="progress">0%</div>
    </div>

    <div id="bear-holder"></div>

    <section class="main_content_scroll" id="new_body">
        <div class="content">
            <div class="section">
                <h1>Scroll down to see the guitar in action</h1>
            </div>
            
            <div class="section guitar-section">
                <h1>Rift Guitar</h1>
                <p>This 3D guitar rotates and moves with your scroll, with floating musical notes</p>
            </div>
            
            <div class="section">
                <h1>Keep scrolling...</h1>
            </div>
            
            <div class="section">
                <h1>The camera follows your scroll movement</h1>
            </div>
            
            <div class="section">
                <h1>End of demo - scroll back up!</h1>
            </div>
        </div>
    </section>

    <script src="three.min.js"></script>
    
    <script>
        let scene, camera, renderer, sphereCamera, guitar, letterG, noteSymbol;
        let new_body = document.getElementById("new_body");
        let loader = document.getElementById("loader");
        let progress = document.getElementById("progress");
        let gOriginalY = 0; // Store G's original Y position
        let noteOriginalY = 0; // Store note's original Y position
        let bounceTime = 0; // Time counter for bounce animation

        function init() {
            const loadingManager = new THREE.LoadingManager(
                //loaded
                () => {
                    console.log("loaded 3d");
                    clearLoader();
                    const t = new_body.scrollTop;
                    camera.position.y = t * -0.004;
                    render();
                },
                //progress
                (itemUrl, itemsLoaded, itemsTotal) => {
                    const percent = Math.round((itemsLoaded / itemsTotal) * 100);
                    progress.textContent = `${percent}%`;
                    console.log(percent + "% loaded");
                }
            );

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 50);
            camera.position.set(0, 0, 5);

            renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
            renderer.setClearColor( 0xffffff, 0 );
            renderer.autoClear = false;
            renderer.setSize(window.innerWidth, window.innerHeight);

            document.getElementById('bear-holder').appendChild(renderer.domElement);

            // Create cube camera for environment reflections (exact original implementation)
            sphereCamera = new THREE.CubeCamera(1, 9000000000000, 500);
            sphereCamera.position.set(0, 0, 0);
            scene.add(sphereCamera);
            
            // Material for 3D objects
            let guitarMaterial = new THREE.MeshPhongMaterial({
                envMap: sphereCamera.renderTarget.texture,
                color: 0x8B4513 // Brown color for guitar
            });

            // Create 3D Guitar using basic shapes
            createGuitar(guitarMaterial);
            
            // Create the letter G after guitar is created
            createLetterG();
            
            // Create musical note symbol
            createNoteSymbol();

            // Original Rift lighting setup
            const ambientLight = new THREE.AmbientLight(0xffffff, 1);
            scene.add(ambientLight);

            // Use exact original environment setup like the original Rift app
            let materialArray = [];
            let texture_ft = new THREE.TextureLoader().load('original_C.jpg');
            let texture_bk = new THREE.TextureLoader().load('original_C.jpg');
            let texture_up = new THREE.TextureLoader().load('original_C.jpg');
            let texture_dn = new THREE.TextureLoader().load('original_C.jpg');
            let texture_rt = new THREE.TextureLoader().load('original_C.jpg');
            let texture_lf = new THREE.TextureLoader().load('original_C.jpg');
            
            materialArray.push(new THREE.MeshBasicMaterial({ map: texture_ft }));
            materialArray.push(new THREE.MeshBasicMaterial({ map: texture_bk }));
            materialArray.push(new THREE.MeshBasicMaterial({ map: texture_up }));
            materialArray.push(new THREE.MeshBasicMaterial({ map: texture_dn }));
            materialArray.push(new THREE.MeshBasicMaterial({ map: texture_rt }));
            materialArray.push(new THREE.MeshBasicMaterial({ map: texture_lf }));
                 
            for (let i = 0; i < 6; i++)
                materialArray[i].side = THREE.BackSide;
                     
            let skyboxGeo = new THREE.SphereGeometry(9000000000000, 62, 62);
            let skybox = new THREE.Mesh(skyboxGeo, materialArray);
            scene.add(skybox);

            const sizes = {
                width: window.innerWidth,
                height: window.innerHeight
            }

            window.addEventListener('resize', () => {
                sizes.width = window.innerWidth;
                sizes.height = window.innerHeight;
                camera.aspect = sizes.width / sizes.height;
                camera.updateProjectionMatrix();
                renderer.setSize(sizes.width, sizes.height);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                
                // Update responsive positioning
                updateResponsivePositioning();
            });
        }

        function createGuitar(material) {
            // Create guitar group
            guitar = new THREE.Group();
            
            // Guitar body (main part)
            const bodyGeometry = new THREE.BoxGeometry(1.5, 2.5, 0.3);
            const body = new THREE.Mesh(bodyGeometry, material);
            body.position.y = -0.5;
            guitar.add(body);
            
            // Guitar neck
            const neckGeometry = new THREE.BoxGeometry(0.3, 2, 0.2);
            const neck = new THREE.Mesh(neckGeometry, material);
            neck.position.y = 1.5;
            guitar.add(neck);
            
            // Guitar head
            const headGeometry = new THREE.BoxGeometry(0.5, 0.5, 0.2);
            const head = new THREE.Mesh(headGeometry, material);
            head.position.y = 2.5;
            guitar.add(head);
            
            // Guitar strings (thin cylinders)
            const stringMaterial = new THREE.MeshPhongMaterial({
                color: 0xC0C0C0, // Silver color
                envMap: sphereCamera.renderTarget.texture
            });
            
            for (let i = 0; i < 6; i++) {
                const stringGeometry = new THREE.CylinderGeometry(0.01, 0.01, 4);
                const string = new THREE.Mesh(stringGeometry, stringMaterial);
                string.position.x = -0.1 + (i * 0.04);
                string.position.y = 0.5;
                guitar.add(string);
            }
            
            // Sound hole (torus)
            const holeGeometry = new THREE.TorusGeometry(0.3, 0.05, 8, 16);
            const holeMaterial = new THREE.MeshPhongMaterial({
                color: 0x000000,
                envMap: sphereCamera.renderTarget.texture
            });
            const hole = new THREE.Mesh(holeGeometry, holeMaterial);
            hole.position.y = -0.5;
            hole.rotation.x = Math.PI / 2;
            guitar.add(hole);
            
            scene.add(guitar);
            
            updateResponsivePositioning();
        }

        function createLetterG() {
            // Create G shape
            const gShape = new THREE.Shape();
            const radius = 0.15;
            
            // Create G letter shape (simplified)
            gShape.absarc(0, 0, 1, 0, Math.PI * 1.5, false); // Outer arc
            gShape.lineTo(0.5, 0);
            gShape.lineTo(0.5, -0.5);
            gShape.lineTo(0, -0.5);
            
            // Inner hole
            const hole = new THREE.Path();
            hole.absarc(0, 0, 0.5, 0, Math.PI * 1.5, false);
            hole.lineTo(0.25, 0);
            hole.lineTo(0.25, -0.25);
            hole.lineTo(0, -0.25);
            gShape.holes.push(hole);
            
            // Extrude the G shape to make it 3D
            const extrudeSettings = {
                depth: 0.2,
                bevelEnabled: true,
                bevelSegments: 2,
                steps: 2,
                bevelSize: 0.1,
                bevelThickness: 0.1
            };
            
            const gGeometry = new THREE.ExtrudeGeometry(gShape, extrudeSettings);
            
            // Use the same material as guitar
            const gMaterial = new THREE.MeshPhongMaterial({
                envMap: sphereCamera.renderTarget.texture,
                color: 0xFF6B35 // Orange color
            });
            
            letterG = new THREE.Mesh(gGeometry, gMaterial);
            
            // Match the guitar's initial rotation exactly and add 45-degree tilt
            letterG.rotation.copy(guitar ? guitar.rotation : new THREE.Euler(0, 0, 0));
            letterG.rotation.z += Math.PI / 4; // Add 45-degree tilt on Z-axis
            
            scene.add(letterG);
            console.log('Letter G added to scene');
        }

        function createNoteSymbol() {
            // Create a musical note symbol using basic shapes
            noteSymbol = new THREE.Group();
            
            // Note head (sphere)
            const headGeometry = new THREE.SphereGeometry(0.2, 16, 16);
            const noteMaterial = new THREE.MeshPhongMaterial({
                envMap: sphereCamera.renderTarget.texture,
                color: 0x000000 // Black color
            });
            const head = new THREE.Mesh(headGeometry, noteMaterial);
            head.position.y = 0;
            noteSymbol.add(head);
            
            // Note stem (cylinder)
            const stemGeometry = new THREE.CylinderGeometry(0.02, 0.02, 1.2);
            const stem = new THREE.Mesh(stemGeometry, noteMaterial);
            stem.position.x = 0.15;
            stem.position.y = 0.6;
            noteSymbol.add(stem);
            
            // Note flag (plane)
            const flagGeometry = new THREE.PlaneGeometry(0.3, 0.4);
            const flag = new THREE.Mesh(flagGeometry, noteMaterial);
            flag.position.x = 0.15;
            flag.position.y = 1.1;
            noteSymbol.add(flag);
            
            scene.add(noteSymbol);
            console.log('Musical note added to scene');
        }

        function updateResponsivePositioning() {
            if (!guitar) return;
            
            // Responsive positioning exactly like original
            if (window.innerWidth < 420) {
                guitar.position.y = -3.38;
                guitar.position.x = 1.6;
                guitar.scale.set(1.3, 1.3, 1.3);
                
                if (letterG) {
                    letterG.position.y = -5.38;
                    letterG.position.x = 1.6;
                    letterG.scale.set(0.8, 0.8, 0.8);
                    gOriginalY = -5.38;
                }
                
                if (noteSymbol) {
                    noteSymbol.position.y = -7.38;
                    noteSymbol.position.x = 1.6;
                    noteSymbol.scale.set(0.6, 0.6, 0.6);
                    noteOriginalY = -7.38;
                }
            }
            else if (window.innerWidth < 770) {
                guitar.position.y = -2.3;
                guitar.position.x = 1;
                guitar.scale.set(1.2, 1.2, 1.2);
                
                if (letterG) {
                    letterG.position.y = -4.3;
                    letterG.position.x = 1;
                    letterG.scale.set(0.9, 0.9, 0.9);
                    gOriginalY = -4.3;
                }
                
                if (noteSymbol) {
                    noteSymbol.position.y = -6.3;
                    noteSymbol.position.x = 1;
                    noteSymbol.scale.set(0.7, 0.7, 0.7);
                    noteOriginalY = -6.3;
                }
            }
            else if (window.innerWidth < 1050) {
                guitar.position.y = -1.3;
                guitar.position.x = 1;
                guitar.scale.set(1, 1, 1);
                
                if (letterG) {
                    letterG.position.y = -3.3;
                    letterG.position.x = 1;
                    letterG.scale.set(0.7, 0.7, 0.7);
                    gOriginalY = -3.3;
                }
                
                if (noteSymbol) {
                    noteSymbol.position.y = -5.3;
                    noteSymbol.position.x = 1;
                    noteSymbol.scale.set(0.5, 0.5, 0.5);
                    noteOriginalY = -5.3;
                }
            }
            else if (window.innerWidth < 1500) {
                guitar.position.y = -3.8;
                guitar.position.x = 0;
                guitar.scale.set(1.3, 1.3, 1.3);
                
                if (letterG) {
                    letterG.position.y = -5.8;
                    letterG.position.x = 0;
                    letterG.scale.set(1, 1, 1);
                    gOriginalY = -5.8;
                }
                
                if (noteSymbol) {
                    noteSymbol.position.y = -7.8;
                    noteSymbol.position.x = 0;
                    noteSymbol.scale.set(0.8, 0.8, 0.8);
                    noteOriginalY = -7.8;
                }
            }
            else if (window.innerWidth < 1550) {
                guitar.position.y = -3.7;
                guitar.position.x = 0;
                guitar.scale.set(1.3, 1.3, 1.3);
                
                if (letterG) {
                    letterG.position.y = -5.7;
                    letterG.position.x = 0;
                    letterG.scale.set(1, 1, 1);
                    gOriginalY = -5.7;
                }
                
                if (noteSymbol) {
                    noteSymbol.position.y = -7.7;
                    noteSymbol.position.x = 0;
                    noteSymbol.scale.set(0.8, 0.8, 0.8);
                    noteOriginalY = -7.7;
                }
            }
            else {
                guitar.position.y = -3.5;
                guitar.position.x = 0;
                guitar.scale.set(1.3, 1.3, 1.3);
                
                if (letterG) {
                    letterG.position.y = -5.5;
                    letterG.position.x = 0;
                    letterG.scale.set(1, 1, 1);
                    gOriginalY = -5.5;
                }
                
                if (noteSymbol) {
                    noteSymbol.position.y = -7.5;
                    noteSymbol.position.x = 0;
                    noteSymbol.scale.set(0.8, 0.8, 0.8);
                    noteOriginalY = -7.5;
                }
            }
        }

        function moveCamera() {
            const t = new_body.scrollTop;

            // Exact camera movement logic from original
            if (window.innerWidth < 450) {
                camera.position.y = t * -0.006;
            }
            else if (window.innerWidth < 770) {
                camera.position.y = t * -0.004;
            }
            else if (window.innerWidth < 1050) {
                camera.position.y = t * -0.003;  
            }
            else if (window.innerWidth < 1500) {
                camera.position.y = t * -0.005;
            }
            else if (window.innerWidth < 1550) {
                camera.position.y = t * -0.005;
            }
            else {
                camera.position.y = t * -0.004;
            }
        }
        
        function render() {
            renderer.render(scene, camera);
            sphereCamera.update(renderer, scene);

            new_body.onscroll = moveCamera;

            requestAnimationFrame(render);

            // Exact rotation from original
            if (guitar) {
                guitar.rotation.x += -0.02;
            }
            
            // Bouncing animation for the letter G (forward/backward)
            if (letterG) {
                bounceTime += 0.1; // Increment time for animation
                const bounceDepth = 2; // How far to bounce forward/backward
                letterG.position.z = Math.sin(bounceTime) * bounceDepth;
            }
            
            // Floating animation for the musical note (up/down)
            if (noteSymbol) {
                const floatHeight = 1.5; // How far to float up/down
                noteSymbol.position.y = noteOriginalY + Math.sin(bounceTime * 0.8) * floatHeight;
            }
        }

        function clearLoader() {
            loader.style.display = 'none';
        }

        // Start the app
        init();
    </script>
</body>
</html>
