<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rift Skateboard - Exact Replica</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background: white;
            overflow: hidden;
            height: 100vh;
        }

        html, body {
            margin: 0;
            height: 100%;
            overflow: hidden; 
        }

        .main_content_scroll {
            overflow-y: scroll;
            height: 100%;
            pointer-events: all;
        }

        .main_content_scroll::-webkit-scrollbar {
            width: 0px;
            display: none;
        }

        #bear-holder {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 98;
            pointer-events: none;
        }

        .content {
            height: 500vh; /* Make it scrollable */
            position: relative;
            z-index: 1;
        }

        .section {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #010031;
            font-family: Arial, sans-serif;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(2px);
        }

        .section:nth-child(even) {
            background: rgba(240, 240, 240, 0.1);
        }

        .skateboard-section {
            background: rgba(255, 255, 255, 0.2);
            flex-direction: column;
            gap: 20px;
        }

        .skateboard-section h1 {
            font-size: 3rem;
            margin: 0;
            background: linear-gradient(90deg, #FF66CC 6.25%, #445FFF 94.27%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        .skateboard-section p {
            font-size: 1.5rem;
            margin: 0;
            text-align: center;
            max-width: 800px;
        }

        .loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #010031;
            font-family: Arial, sans-serif;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .noise {
            -webkit-animation: noise 1.2s steps(3) infinite both;
            animation: noise 1.2s steps(3) infinite both;
            background: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSJibGFjayIgZmlsbC1vcGFjaXR5PSIwLjEiLz4KPHN2Zz4K");
            background-size: 64px;
            height: 200%;
            left: -50%;
            pointer-events: none;
            position: fixed;
            top: -50%;
            width: 200%;
            will-change: auto;
            z-index: 100;
            opacity: 0.05;
        }

        @keyframes noise {
            0% { -webkit-transform: translate3d(1%,-1%,0); transform: translate3d(1%,-1%,0) }
            10% { -webkit-transform: translate3d(-5%,-2%,0); transform: translate3d(-5%,-2%,0) }
            20% { -webkit-transform: translate3d(10%,5%,0); transform: translate3d(10%,5%,0) }
            30% { -webkit-transform: translate3d(5%,-11%,0); transform: translate3d(5%,-11%,0) }
            40% { -webkit-transform: translate3d(-12%,-5%,0); transform: translate3d(-12%,-5%,0) }
            50% { -webkit-transform: translate3d(10%,9%,0); transform: translate3d(10%,9%,0) }
            60% { -webkit-transform: translate3d(15%,0,0); transform: translate3d(15%,0,0) }
            70% { -webkit-transform: translate3d(-10%,8%,0); transform: translate3d(-10%,8%,0) }
            80% { -webkit-transform: translate3d(10%,2%,0); transform: translate3d(10%,2%,0) }
            90% { -webkit-transform: translate3d(1%,5%,0); transform: translate3d(1%,5%,0) }
            to { -webkit-transform: translate3d(0,8%,0); transform: translate3d(0,8%,0) }
        }
    </style>
</head>
<body>
    <div class="noise"></div>
    
    <div class="loader" id="loader">
        <div>Loading Rift Skateboard...</div>
        <div id="progress">0%</div>
    </div>

    <div id="bear-holder"></div>

    <section class="main_content_scroll" id="new_body">
        <div class="content">
            <div class="section">
                <h1>Scroll down to see the skateboard in action</h1>
            </div>
            
            <div class="section skateboard-section">
                <h1>Rift Skateboard</h1>
                <p>This 3D skateboard rotates and moves with your scroll, exactly like in the original Rift app</p>
            </div>
            
            <div class="section">
                <h1>Keep scrolling...</h1>
            </div>
            
            <div class="section">
                <h1>The camera follows your scroll movement</h1>
            </div>
            
            <div class="section">
                <h1>End of demo - scroll back up!</h1>
            </div>
        </div>
    </section>

    <script src="three.min.js"></script>
    <script src="OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/FontLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/geometries/TextGeometry.js"></script>
    
    <script>
        let scene, camera, renderer, sphereCamera, skate;
        let new_body = document.getElementById("new_body");
        let loader = document.getElementById("loader");
        let progress = document.getElementById("progress");

        function init() {
            const loadingManager = new THREE.LoadingManager(
                //loaded
                () => {
                    console.log("loaded 3d");
                    clearLoader();
                    const t = new_body.scrollTop;
                    camera.position.y = t * -0.004;
                    render();
                },
                //progress
                (itemUrl, itemsLoaded, itemsTotal) => {
                    const percent = Math.round((itemsLoaded / itemsTotal) * 100);
                    progress.textContent = `${percent}%`;
                    console.log(percent + "% loaded");
                }
            );

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 50);
            camera.position.set(0, 0, 5);

            renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
            renderer.setClearColor( 0xffffff, 0 );
            renderer.autoClear = false;
            renderer.setSize(window.innerWidth, window.innerHeight);

            document.getElementById('bear-holder').appendChild(renderer.domElement);

            // Create cube camera for environment reflections (exact original implementation)
            sphereCamera = new THREE.CubeCamera(1, 9000000000000, 500);
            sphereCamera.position.set(0, 0, 0);
            scene.add(sphereCamera);
            
            // Exact original material from Rift app
            let skateMaterial = new THREE.MeshPhongMaterial({
                envMap: sphereCamera.renderTarget.texture
            });

            const loaderS = new THREE.OBJLoader(loadingManager);

            loaderS.load(
                'skateboard.obj',
                function(object3) {
                    console.log('Skateboard loaded successfully:', object3);
                    object3.traverse(function(child) {
                        if (child instanceof THREE.Mesh) {
                            console.log('Found mesh:', child);
                            child.material = skateMaterial;
                            child.material.flatShading = false;
                            skate = object3;
                        }
                    });

                    scene.add(object3);
                    console.log('Skateboard added to scene');

                    // Responsive positioning exactly like original
                    if (window.innerWidth < 420) {
                        object3.position.y = -3.38;
                        object3.position.x = 1.6;
                        object3.scale.set(1.3, 1.3, 1.3);
                    }
                    else if (window.innerWidth < 770) {
                        object3.position.y = -2.3;
                        object3.position.x = 1;
                        object3.scale.set(1.2, 1.2, 1.2);
                    }
                    else if (window.innerWidth < 1050) {
                        object3.position.y = -1.3;
                        object3.position.x = 1;
                        object3.scale.set(1, 1, 1);
                    }
                    else if (window.innerWidth < 1500) {
                        object3.position.y = -3.8;
                        object3.position.x = 0;
                        object3.scale.set(1.3, 1.3, 1.3);
                    }
                    else if (window.innerWidth < 1550) {
                        object3.position.y = -3.7;
                        object3.position.x = 0;
                        object3.scale.set(1.3, 1.3, 1.3);
                    }
                    else {
                        object3.position.y = -3.5;
                        object3.position.x = 0;
                        object3.scale.set(1.3, 1.3, 1.3);
                    }
                    
                },
                function(xhr) {
                    console.log((xhr.loaded / xhr.total * 100) + '% loaded');
                },
                function(error) {
                    console.log('An error happened');
                }
            );


            // Original Rift lighting setup
            const ambientLight = new THREE.AmbientLight(0xffffff, 1);
            scene.add(ambientLight);

            // Use exact original environment setup like the original Rift app
            let materialArray = [];
            let texture_ft = new THREE.TextureLoader().load('original_C.jpg');
            let texture_bk = new THREE.TextureLoader().load('original_C.jpg');
            let texture_up = new THREE.TextureLoader().load('original_C.jpg');
            let texture_dn = new THREE.TextureLoader().load('original_C.jpg');
            let texture_rt = new THREE.TextureLoader().load('original_C.jpg');
            let texture_lf = new THREE.TextureLoader().load('original_C.jpg');
            
            materialArray.push(new THREE.MeshBasicMaterial({ map: texture_ft }));
            materialArray.push(new THREE.MeshBasicMaterial({ map: texture_bk }));
            materialArray.push(new THREE.MeshBasicMaterial({ map: texture_up }));
            materialArray.push(new THREE.MeshBasicMaterial({ map: texture_dn }));
            materialArray.push(new THREE.MeshBasicMaterial({ map: texture_rt }));
            materialArray.push(new THREE.MeshBasicMaterial({ map: texture_lf }));
                 
            for (let i = 0; i < 6; i++)
                materialArray[i].side = THREE.BackSide;
                     
            let skyboxGeo = new THREE.SphereGeometry(9000000000000, 62, 62);
            let skybox = new THREE.Mesh(skyboxGeo, materialArray);
            scene.add(skybox);

            const sizes = {
                width: window.innerWidth,
                height: window.innerHeight
            }

            window.addEventListener('resize', () => {
                sizes.width = window.innerWidth;
                sizes.height = window.innerHeight;
                camera.aspect = sizes.width / sizes.height;
                camera.updateProjectionMatrix();
                renderer.setSize(sizes.width, sizes.height);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            });
        }

        function moveCamera() {
            const t = new_body.scrollTop;

            // Exact camera movement logic from original
            if (window.innerWidth < 450) {
                camera.position.y = t * -0.006;
            }
            else if (window.innerWidth < 770) {
                camera.position.y = t * -0.004;
            }
            else if (window.innerWidth < 1050) {
                camera.position.y = t * -0.003;  
            }
            else if (window.innerWidth < 1500) {
                camera.position.y = t * -0.005;
            }
            else if (window.innerWidth < 1550) {
                camera.position.y = t * -0.005;
            }
            else {
                camera.position.y = t * -0.004;
            }
        }
        
        function render() {
            renderer.render(scene, camera);
            sphereCamera.update(renderer, scene);

            new_body.onscroll = moveCamera;

            requestAnimationFrame(render);

            // Exact rotation from original
            if (skate) {
                skate.rotation.x += -0.02;
            }
        }

        function clearLoader() {
            loader.style.display = 'none';
        }

        // Start the app
        init();
    </script>
</body>
</html>
